{{ define "main" }}

<article class="pagina">

  <!-- HEADER -->
  <header class="page-header">
    <div class="container">
      <div class="editorial-content">
        <h1>{{ .Title }}</h1>

        {{ with .Params.description }}
          <p class="lead">{{ . }}</p>
        {{ end }}
      </div>
    </div>
  </header>

  <!-- CONTE√öDO EDITORIAL -->
  <section class="pagina-conteudo section">
    <div class="container">
      <div class="editorial-content">
        {{ .Content }}
      </div>
    </div>
  </section>

  <!-- LOCAIS KWANZA -->
  {{ with .Params.locais_kwanza }}
  <section class="locais-kwanza section">
    <div class="container">
      <div class="locais-conteudo">

        <h2>{{ i18n "kwanza_locations" }}</h2>

        {{/* BANDEIRAS (√≠cones para evitar renderiza√ß√£o inconsistente de emoji no Chrome) */}}
        {{ $bandeiras := dict
          "Brasil" "/img/flags/br.webp"
          "Brazil" "/img/flags/br.webp"
          "Chile" "/img/flags/cl.webp"
          "M√©xico" "/img/flags/mx.webp"
          "Mexico" "/img/flags/mx.webp"
        }}

        {{ $paisAnterior := "" }}
        {{ $estadoAnterior := "" }}

        {{ range . }}

          {{/* NOVO PA√çS */}}
          {{ if ne .pais $paisAnterior }}

            {{ if ne $paisAnterior "" }}
                </div>
              </details>
            {{ end }}

            <details class="locais-pais">
              <summary>
                {{ with index $bandeiras .pais }}
                  <img class="flag-icon" src="{{ . }}" alt="" aria-hidden="true" loading="lazy" decoding="async">
                {{ end }}
                <span>{{ .pais }}</span>
              </summary>

              <div class="locais-pais-conteudo">

            {{ $paisAnterior = .pais }}
            {{ $estadoAnterior = "" }}

          {{ end }}

          {{/* NOVO ESTADO (SEMPRE DENTRO DO PA√çS) */}}
          {{ if ne .estado $estadoAnterior }}
            <h4 class="locais-estado">{{ .estado }}</h4>
            {{ $estadoAnterior = .estado }}
          {{ end }}

          <!-- LOCAL -->
          <div class="local-item">
            <p>
              <strong>{{ .nome }}</strong>

              <span>
                {{ .endereco }}<br>
                {{ .cidade }}{{ if .estado }} ‚Äì {{ .estado }}{{ end }}
              </span>

              {{ if .telefone }}
                üìû {{ .telefone }}
              {{ end }}

              {{ if and .lat .lng }}
                <br>
                <a
                  href="https://maps.google.com/?q={{ .lat }},{{ .lng }}"
                  target="_blank"
                  rel="noopener noreferrer">
                  {{ i18n "view_on_map" }}
                </a>
              {{ end }}
            </p>
          </div>

        {{ end }}

        {{/* FECHA √öLTIMO PA√çS */}}
            </div>
          </details>

      </div>
    </div>
  </section>
  {{ end }}

</article>

{{ end }}
