{{ define "main" }}

<article class="pagina">

  <header class="pagina-header section">
    <div class="container">
      <h1>{{ .Title }}</h1>

      {{ with .Params.description }}
        <p class="pagina-subtitulo">{{ . }}</p>
      {{ end }}
    </div>
  </header>

  <section class="pagina-conteudo section">
    <div class="container">
      {{ .Content }}
    </div>
  </section>

  {{ with .Params.locais_kwanza }}
  <section class="locais-kwanza section">
    <div class="container">

      <h2>Locais Kwanza</h2>

      {{/* =============================
           MAPA DE BANDEIRAS
           ============================= */}}
      {{ $bandeiras := dict
        "Brasil" "ğŸ‡§ğŸ‡·"
        "Chile"  "ğŸ‡¨ğŸ‡±"
        "MÃ©xico" "ğŸ‡²ğŸ‡½"
      }}

      {{/* =============================
           PAÃS â†’ ESTADO â†’ NOMES
           ============================= */}}

      {{ $scratch := newScratch }}

      {{/* Indexa por pais/estado */}}
      {{ range . }}
        {{ if and (isset . "pais") (isset . "estado") }}
          {{ $key := printf "%s|%s" .pais .estado }}
          {{ $scratch.Add $key (slice .) }}
        {{ end }}
      {{ end }}

      {{/* Lista de paÃ­ses Ãºnicos */}}
      {{ $paises := slice }}
      {{ range . }}
        {{ if not (in $paises .pais) }}
          {{ $paises = $paises | append .pais }}
        {{ end }}
      {{ end }}

      {{/* RenderizaÃ§Ã£o */}}
      {{ range $paises }}
        {{ $paisAtual := . }}

        <h3 class="locais-pais">
          {{ with index $bandeiras $paisAtual }}{{ . }} {{ end }}{{ $paisAtual }}
        </h3>

        {{ range $key, $items := $scratch.Values }}
          {{ $parts := split $key "|" }}

          {{ if eq (index $parts 0) $paisAtual }}

            <h4 class="locais-estado">{{ index $parts 1 }}</h4>

            {{ range $items }}
              <div class="local-item">
                <p>
                  <strong>{{ .nome }}</strong>

                  <span>
                    {{ .endereco }}<br>
                    {{ .cidade }} â€“ {{ .estado }}
                  </span>

                  ğŸ“ {{ .telefone }} â€”
                  <a
                    href="https://maps.google.com/?q={{ .lat }},{{ .lng }}"
                    target="_blank"
                    rel="noopener">
                    Ver no mapa
                  </a>
                </p>
              </div>
            {{ end }}

          {{ end }}
        {{ end }}

      {{ end }}

    </div>
  </section>
  {{ end }}

</article>

{{ end }}
