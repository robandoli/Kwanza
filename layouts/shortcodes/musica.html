<div class="musica-bloco">

  <header class="musica-header">
    <h3>{{ .Get "titulo" }}</h3>

    {{ with .Get "autor" }}
      <p class="musica-autor">{{ . }}</p>
    {{ end }}
  </header>

  <div class="musica-conteudo">
    <details class="musica-letra">
      <summary>Veja aqui a letra</summary>

      <div class="musica-letra-conteudo">
        {{ $letra := .InnerDeindent | strings.TrimSpace }}
        {{ $letra = replaceRE "\r\n" "\n" $letra }}
        {{ $linhas := split $letra "\n" }}
        {{ $total := len $linhas }}
        {{ $saida := newScratch }}

        {{ range $i, $linha := $linhas }}
          {{ $linhaLimpa := $linha | strings.TrimSpace }}
          {{ if eq $linhaLimpa "" }}
            {{ $saida.Add "html" "<br>" }}
          {{ else }}
            {{ $saida.Add "html" ($.Page.RenderString (dict "display" "inline") $linha) }}
            {{ if lt $i (sub $total 1) }}
              {{ $saida.Add "html" "<br>" }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{ $saida.Get "html" | safeHTML }}
      </div>
    </details>

    {{ if .Get "youtube" }}
      <div class="musica-media">
        <iframe
          src="https://www.youtube.com/embed/{{ .Get "youtube" }}"
          loading="lazy"
          referrerpolicy="strict-origin-when-cross-origin"
          sandbox="allow-scripts allow-same-origin allow-presentation"
          allowfullscreen>
        </iframe>
      </div>
    {{ else if .Get "audio" }}
      <div class="musica-media">
        <audio controls>
          <source src="{{ .Get "audio" }}" type="audio/mpeg">
        </audio>
      </div>
    {{ end }}
  </div>

</div>
